<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë‹¬ë ¥(ì„ë² ë“œ)</title>

  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

  <style>
    /* iframe ì•ˆì—ì„œ ìŠ¤í¬ë¡¤ë°” ìƒê¸°ì§€ ì•Šê²Œ */
    html, body { margin: 100; padding: 0; height: 100%; overflow: hidden; }
    body { font-family: system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", Arial; padding:12px; }

    @media (max-width: 480px) {
      body { padding: 6px; }   /* âœ… ëª¨ë°”ì¼ì—ì„œ ë” ë„“ê²Œ */
    }

    /* âœ… í•µì‹¬: ëª¨ë°”ì¼ì—ì„œëŠ” max-width í•´ì œí•´ì„œ ê½‰ ì°¨ê²Œ */
    #calendar{
      width: 100%;
      height: 100%;
      max-width: none;  /* PCì—ì„œëŠ” ìœ ì§€ */
      margin: 0;
    }
    @media (max-width: 480px) {
      #calendar { max-width: none; }  /* âœ… ëª¨ë°”ì¼ì—ì„œ ì œí•œ ì œê±° */
    }

    .fc { margin: 0; }

    /* ìš”ì¼ ìƒ‰ìƒ */
    .fc .fc-col-header-cell.fc-day-sun .fc-col-header-cell-cushion { color:#d00; font-weight:700; }
    .fc .fc-col-header-cell.fc-day-sat .fc-col-header-cell-cushion { color:#06c; font-weight:700; }
    .fc .fc-daygrid-day.fc-day-sun .fc-daygrid-day-number { color:#d00; font-weight:700; }
    .fc .fc-daygrid-day.fc-day-sat .fc-daygrid-day-number { color:#06c; font-weight:700; }

    /* ë‚´ë¶€ ìŠ¤í¬ë¡¤(íŒŒë€ ìŠ¤í¬ë¡¤ë°”) ë°©ì§€ */
    .fc .fc-scroller { overflow: hidden !important; }

    /* ===== ì´ë²¤íŠ¸(ì¹©) ìŠ¤íƒ€ì¼: ì—°ì°¨/ë°˜ì°¨ êµ¬ë¶„ ===== */
    .fc .fc-daygrid-event { white-space: normal; border: 0; }
    .fc .fc-daygrid-event .fc-event-main { padding: 0; }

    /* ì—°ì°¨(ê¸°ë³¸) = íŒŒë€ ì¹© */
    .fc .fc-daygrid-event.ev-annual {
      background: rgba(37, 99, 235, 0.95);
      border-radius: 8px;
      padding: 2px 6px;
    }
    /* ë°˜ì°¨ = ì—°í•œ í•˜ëŠ˜ìƒ‰ ì¹© */
    .fc .fc-daygrid-event.ev-half {
      background: rgba(96, 165, 250, 0.95);
      border-radius: 8px;
      padding: 2px 6px;
    }

    /* ì´ë¦„/ë¼ë²¨ ê¸€ì”¨ */
    .fc-emp-name{
      color:#fff;
      font-size:12px;
      font-weight:500;
      letter-spacing:-0.005em;
      line-height:1.15;
      padding-left: 5px;
    }
    .fc-half-label{
      display:block;
      margin-top:2px;
      font-size:11px;
      font-weight:500;
      color:#fff;
      line-height:1.1;
      letter-spacing:-0.01em;
      opacity:0.95;
      padding-left: 5px;
    }

    /* âœ… ê³¼ê±° ë‚ ì§œ: ì¹¸ ë°°ê²½ë§Œ ì•„ì£¼ ì‚´ì§ íšŒìƒ‰ */
    .fc .fc-daygrid-day.fc-past-soft { background: rgba(0,0,0,0.03); }

    /* âœ… +N(ë”ë³´ê¸°) */
    .fc .fc-daygrid-more-link{
      color:#111;
      font-weight:600;
    }

    /* âœ… íŒì˜¤ë²„(ë”ë³´ê¸° ì°½) : ê²€ì€ ë°°ê²½ + í° ê¸€ì”¨ */
    .fc .fc-popover{
      background: rgba(0,0,0,0.92);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 12px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.35);
      color:#fff;
    }
    .fc .fc-popover-header{
      background: transparent;
      border-bottom: 1px solid rgba(255,255,255,0.12);
      color:#fff;
    }
    .fc .fc-popover-title{ color:#fff; font-weight:700; }
    .fc .fc-popover-close{
      color:#fff;
      opacity:0.9;
    }
    .fc .fc-popover-body{ color:#fff; }

    /* âœ… íŒì˜¤ë²„ ì•ˆì˜ ì´ë²¤íŠ¸ë„ "ì¹© ìƒ‰ìƒ"ì´ ê·¸ëŒ€ë¡œ ë³´ì´ê²Œ */
    .fc .fc-popover .fc-daygrid-event { margin: 4px 0; }

    /* ëª¨ë°”ì¼ í—¤ë” */
    @media (max-width: 480px) {
      .fc .fc-header-toolbar { flex-wrap: wrap; gap: 6px; }
      .fc .fc-toolbar-title { font-size: 20px; }
      .fc .fc-button { padding: 6px 10px; font-size: 13px; }
    }

    /* ë©”ëª¨ ì´ë²¤íŠ¸(íšŒìƒ‰ ê³„ì—´) */
    .fc .fc-memo-event,
    .fc .fc-memo-event .fc-event-main {
      background: rgba(0,0,0,0.65) !important;
      border-color: rgba(0,0,0,0.65) !important;
      border-radius: 8px;
      padding: 2px 6px;
    }
    .fc .fc-memo-event .fc-event-title,
    .fc .fc-memo-event .fc-event-main-frame {
      color: #fff !important;
      font-weight: 600;
    }

    /* âœ… ê³µíœ´ì¼ ì´ë²¤íŠ¸: ê¸€ìë§Œ ì‹¬í”Œí•˜ê²Œ + ë¹¨ê°„ìƒ‰ */
    .fc-holiday-text{
      color:#d00;
      font-weight:600;
      font-size:12px;
      line-height:1.1;
      letter-spacing:-0.01em;
      padding-left: 2px;
    }

    /* âœ… ê³µíœ´ì¼ ë‚ ì§œ ìˆ«ìë§Œ ë¹¨ê°„ìƒ‰ (ì§€ì› ë¸Œë¼ìš°ì €ì—ì„œë§Œ) */
    .fc-daygrid-day:has(.fc-holiday-event) .fc-daygrid-day-number {
      color:#d00 !important;
      font-weight:500;
    }

    /* âœ… íƒ€ì´í‹€: ì›” í¬ê²Œ + ë…„ ì‘ê²Œ */
    .fc .fc-toolbar-title{
      display:flex;
      align-items:baseline;
      gap:10px;
    }
    .fc-title-month{
      font-size:40px;
      font-weight:800;
      line-height:1;
    }
    .fc-title-year{
      font-size:16px;
      font-weight:600;
      opacity:.75;
      line-height:1;
    }

    /* âœ… ê³µíœ´ì¼ ì´ë²¤íŠ¸: ê¸€ìë§Œ ë¹¨ê°„ìƒ‰, ë°°ê²½ ì™„ì „ ì œê±° */
      .fc-daygrid-event.fc-holiday-event,
      .fc-daygrid-event.fc-holiday-event .fc-event-main,
      .fc-daygrid-event.fc-holiday-event .fc-event-title {
        background: transparent !important;
        border: 0 !important;
        box-shadow: none !important;
        color: #d00 !important;
        font-weight: 500 !important;
        padding: 0 !important;
      }

      /* í˜¹ì‹œ ë¼ìš´ë“œ/ì¹©ì´ ë‚¨ì•„ìˆìœ¼ë©´ ì œê±° */
      .fc-daygrid-event.fc-holiday-event {
        border-radius: 0 !important;
      }

  </style>
</head>

<body>
  <div id="calendar"></div>

  <script>
    const EVENTS_URL = "{% url 'leaves:events_api' %}";

    function startOfToday() {
      const d = new Date();
      d.setHours(0,0,0,0);
      return d;
    }

    document.addEventListener('DOMContentLoaded', function () {
      const calendarEl = document.getElementById('calendar');

      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        height: '100%',
        contentHeight: 'auto',

        events: EVENTS_URL,

        headerToolbar: {
          left: 'title',
          center: '',
          right: 'today prev,next'
        },

        datesSet: function(info) {
          const d = new Date(info.view.currentStart);
          const month = d.getMonth() + 1;
          const year = d.getFullYear();

          const titleEl = document.querySelector('.fc .fc-toolbar-title');
          if (titleEl) {
            titleEl.innerHTML = `
              <span class="fc-title-month">${month}</span>
              <span class="fc-title-year">${year}</span>
            `;
          }
        },

        dayMaxEventRows: 3,
        moreLinkClick: 'popover',

        dateClick: function(info) {
          const today0 = startOfToday();
          const clicked = new Date(info.date);
          clicked.setHours(0,0,0,0);
          if (clicked < today0) return;
        },

        dayCellClassNames: function(arg) {
          const today0 = startOfToday();
          const cell = new Date(arg.date);
          cell.setHours(0,0,0,0);
          if (cell < today0) return ['fc-past-soft'];
          return [];
        },

        /* âœ… í•µì‹¬: ê³µíœ´ì¼/ë©”ëª¨ëŠ” ë”°ë¡œ ë Œë”ë§í•˜ê³ , ì§ì› ì´ë²¤íŠ¸ë§Œ ê¸°ì¡´ ìœ ì§€ */
        eventContent: function(arg) {
          const classes = arg.event.classNames || [];

          // 1) ê³µíœ´ì¼: ë¹¨ê°„ ê¸€ìë§Œ (ì¹© X)
          if (classes.includes('fc-holiday-event')) {
            return {
              html: `<div class="fc-holiday-text">${arg.event.title}</div>`
            };
          }

          // 2) ë©”ëª¨: ì œëª©/ë‚´ìš© ê·¸ëŒ€ë¡œ(í°ìƒ‰) - ê¸°ì¡´ classë¡œ ë°°ê²½ ì ìš©ë¨
          if (classes.includes('fc-memo-event')) {
            // ë©”ëª¨ëŠ” title ìì²´ê°€ "ğŸ“ ..." í˜•íƒœë¼ ê·¸ëŒ€ë¡œ ì¶œë ¥
            return {
              html: `<div class="fc-emp-name" style="font-weight:600;">${arg.event.title}</div>`
            };
          }

          // 3) ì§ì›(ì—°ì°¨/ë°˜ì°¨)
          const isMobile = window.matchMedia('(max-width: 480px)').matches;
          const wrap = document.createElement('div');
          const half = arg.event.extendedProps.halfLabel;

          if (!isMobile && half) {
            const oneLine = document.createElement('div');
            oneLine.className = 'fc-emp-name';
            oneLine.textContent = `${arg.event.title}-${half}`;
            wrap.appendChild(oneLine);
            return { domNodes: [wrap] };
          }

          const nameEl = document.createElement('div');
          nameEl.className = 'fc-emp-name';
          nameEl.textContent = arg.event.title;
          wrap.appendChild(nameEl);

          if (half) {
            const halfEl = document.createElement('div');
            halfEl.textContent = half;
            halfEl.className = 'fc-half-label';
            wrap.appendChild(halfEl);
          }

          return { domNodes: [wrap] };
        },
      });

      calendar.render();
    });
  </script>
</body>
</html>
